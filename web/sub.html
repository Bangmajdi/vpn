<!DOCTYPE html>
<html lang="en" id="html" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Yumi - Proxy</title>
    <link
      rel="icon"
      type="image/x-icon"
      href="https://github.com/user-attachments/assets/b5feabb7-3f20-4028-9436-e3f3307dd2ae"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* For Webkit-based browsers (Chrome, Safari and Opera) */
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }

      /* For IE, Edge and Firefox */
      .scrollbar-hide {
        -ms-overflow-style: none; /* IE and Edge */
        scrollbar-width: none; /* Firefox */
      }
      body {
         background-color: #171717;
      }
      .dark body {
         background-color: #171717;
      }
      html:not(.dark) body {
         background-color: #ffffff;
      }
    </style>
    <script>
      tailwind.config = {
        darkMode: "class",
      };
    </script>
  </head>
  <body class="bg-white dark:bg-neutral-800 bg-fixed">
    <!-- Notification -->
    <div
      id="notification-badge"
      class="fixed z-50 opacity-0 transition-opacity ease-in-out duration-300 mt-9 mr-6 right-0 p-3 max-w-sm bg-white dark:bg-neutral-900 rounded-xl border-2 border-neutral-800 dark:border-neutral-700 flex items-center gap-x-4 shadow-lg"
    >
      <div class="shrink-0">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="currentColor"
          class="size-6 text-blue-500"
        >
          <path
            fill-rule="evenodd"
            d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z"
            clip-rule="evenodd"
          />
        </svg>
      </div>
      <div>
        <div id="notification-title" class="text-md font-bold text-blue-500">
          Berhasil!
        </div>
        <p id="notification-message" class="text-sm text-neutral-800 dark:text-neutral-300">
          Teks berhasil disalin
        </p>
      </div>
    </div>

    <!-- Country Sidebar -->
    <div
      class="h-full fixed top-0 w-14 bg-white dark:bg-neutral-800 border-r-2 border-neutral-200 dark:border-neutral-700 z-20 overflow-y-auto scrollbar-hide"
    >
      <div
        id="country-flags-container"
        class="text-2xl flex flex-col items-center h-full gap-3 py-4"
      >
        <!-- Flags will be populated here -->
         <div class="flex justify-center items-center h-full">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="ml-14">
      <!-- Header Info -->
      <div
        id="container-header"
        class="bg-amber-400 dark:bg-amber-500 border-b-2 border-neutral-800 dark:border-black text-right px-5"
      >
        <div
          class="flex justify-end gap-4 text-sm font-medium text-neutral-800 dark:text-black"
        >
          <p id="container-info-ip">IP: Loading...</p>
          <p id="container-info-country">Country: Loading...</p>
          <p id="container-info-isp">ISP: Loading...</p>
        </div>
      </div>

      <div class="container mx-auto px-4">
        <div
          id="container-title"
          class="sticky top-0 bg-white/80 dark:bg-neutral-800/80 backdrop-blur-sm border-b-2 border-neutral-200 dark:border-neutral-700 z-10 py-6 w-full"
        >
          <h1
            id="main-title"
            class="text-xl text-center text-neutral-800 dark:text-white"
          >
            Welcome to
            <span class="text-blue-500 font-semibold">Yumi Proxy</span>
          </h1>
        </div>
        <div
          id="proxy-group-container"
          class="flex justify-center pt-10 w-full"
        >
           <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Loading Skeletons -->
                <div class="animate-pulse mb-2 bg-white dark:bg-neutral-900 transition-transform duration-200 rounded-lg p-4 w-60 h-48 border-2 border-neutral-200 dark:border-neutral-700">
                    <div class="h-4 bg-gray-300 dark:bg-neutral-700 rounded w-3/4 mb-4"></div>
                    <div class="h-10 bg-gray-300 dark:bg-neutral-700 rounded mb-4"></div>
                    <div class="space-y-2">
                        <div class="h-8 bg-gray-300 dark:bg-neutral-700 rounded"></div>
                        <div class="h-8 bg-gray-300 dark:bg-neutral-700 rounded"></div>
                    </div>
                </div>
                 <div class="animate-pulse mb-2 bg-white dark:bg-neutral-900 transition-transform duration-200 rounded-lg p-4 w-60 h-48 border-2 border-neutral-200 dark:border-neutral-700">
                    <div class="h-4 bg-gray-300 dark:bg-neutral-700 rounded w-3/4 mb-4"></div>
                    <div class="h-10 bg-gray-300 dark:bg-neutral-700 rounded mb-4"></div>
                    <div class="space-y-2">
                        <div class="h-8 bg-gray-300 dark:bg-neutral-700 rounded"></div>
                        <div class="h-8 bg-gray-300 dark:bg-neutral-700 rounded"></div>
                    </div>
                </div>
                 <div class="animate-pulse mb-2 bg-white dark:bg-neutral-900 transition-transform duration-200 rounded-lg p-4 w-60 h-48 border-2 border-neutral-200 dark:border-neutral-700">
                    <div class="h-4 bg-gray-300 dark:bg-neutral-700 rounded w-3/4 mb-4"></div>
                    <div class="h-10 bg-gray-300 dark:bg-neutral-700 rounded mb-4"></div>
                    <div class="space-y-2">
                        <div class="h-8 bg-gray-300 dark:bg-neutral-700 rounded"></div>
                        <div class="h-8 bg-gray-300 dark:bg-neutral-700 rounded"></div>
                    </div>
                </div>
           </div>
        </div>

        <!-- Pagination -->
        <nav
          id="container-pagination"
          class="w-full mt-8 sticky bottom-0 right-0 left-0 transition-transform -translate-y-6 z-20"
        >
          <ul id="pagination-buttons" class="flex justify-center space-x-4">
            <!-- Pagination buttons will be populated here -->
          </ul>
        </nav>
      </div>
    </div>

    <!-- Modal Windows -->
    <div id="container-window" class="hidden">
        <div class="fixed inset-0 bg-black/60 backdrop-blur-sm z-30"></div>
      <!-- Informations -->
      <div class="fixed z-40 top-0 w-full h-full flex justify-center items-center">
        <p
          id="container-window-info"
          class="text-center text-lg font-semibold dark:text-white bg-white/80 dark:bg-neutral-800/80 p-6 rounded-lg shadow-xl"
        ></p>
      </div>
      <!-- Output Format -->
      <div
        id="output-window"
        class="fixed z-40 top-0 right-0 w-full h-full flex justify-center items-center hidden"
      >
        <div class="w-[90%] max-w-sm h-auto flex flex-col gap-3 p-4 text-center rounded-lg bg-white dark:bg-neutral-800 shadow-2xl border border-neutral-200 dark:border-neutral-700">
            <h3 class="text-lg font-bold text-neutral-800 dark:text-white mb-2">Pilih Format Output</h3>
            <div class="grid grid-cols-2 gap-3">
                 <button
                    onclick="copyToClipboardAsTarget('clash')"
                    class="p-3 rounded-lg bg-amber-400 hover:bg-amber-500 text-neutral-800 font-semibold transition-all"
                  >
                    Clash
                  </button>
                  <button
                    onclick="copyToClipboardAsTarget('sfa')"
                    class="p-3 rounded-lg bg-amber-400 hover:bg-amber-500 text-neutral-800 font-semibold transition-all"
                  >
                    SFA
                  </button>
                  <button
                    onclick="copyToClipboardAsTarget('bfr')"
                    class="p-3 rounded-lg bg-amber-400 hover:bg-amber-500 text-neutral-800 font-semibold transition-all"
                  >
                    BFR
                  </button>
                  <button
                    onclick="copyToClipboardAsTarget('v2ray')"
                    class="p-3 rounded-lg bg-amber-400 hover:bg-amber-500 text-neutral-800 font-semibold transition-all"
                  >
                    V2Ray/Xray
                  </button>
            </div>
             <button
                onclick="copyToClipboardAsRaw()"
                class="w-full p-3 rounded-lg bg-blue-500 hover:bg-blue-600 text-white font-semibold transition-all"
              >
                Raw
              </button>
             <button
                onclick="toggleOutputWindow()"
                class="w-full p-3 mt-2 rounded-lg bg-neutral-200 dark:bg-neutral-700 hover:bg-neutral-300 dark:hover:bg-neutral-600 text-neutral-800 dark:text-white font-semibold transition-all"
              >
                Close
              </button>
        </div>
      </div>
    </div>

    <!-- Footer Buttons -->
    <footer>
      <div class="fixed bottom-4 right-4 flex flex-col gap-3 z-50">
        <a id="donate-link" href="#" target="_blank">
          <button
            class="w-12 h-12 bg-green-500 hover:bg-green-600 text-white rounded-full border-2 border-white dark:border-neutral-800 flex items-center justify-center shadow-lg transition-transform hover:scale-110"
          >
            <i class="fas fa-hand-holding-heart text-xl"></i>
          </button>
        </a>
        <button
          onclick="toggleDarkMode()"
          class="w-12 h-12 bg-amber-400 hover:bg-amber-500 text-neutral-800 rounded-full border-2 border-white dark:border-neutral-800 flex items-center justify-center shadow-lg transition-transform hover:scale-110"
        >
            <i class="fas fa-sun text-xl dark:hidden"></i>
            <i class="fas fa-moon text-xl hidden dark:inline"></i>
        </button>
      </div>
    </footer>

    <script>
        // --- CONFIGURATION ---
        const SERVICE_NAME = "vpnn";
        const ROOT_DOMAIN = "bangjdi.dpdns.org";
        const PROXY_BANK_URL = "https://raw.githubusercontent.com/Mayumiwandi/Emilia/refs/heads/main/Data/alive.txt";
        const PROXY_HEALTH_CHECK_API = "https://yumi-proxy.vercel.app/api/v1";
        const CONVERTER_URL = "https://api.foolvpn.me/convert";
        const DONATE_LINK = "https://trakteer.id/mayumiwandi/tip";
        const PROXY_PER_PAGE = 20;

        // --- GLOBAL STATE ---
        let fullProxyList = [];
        let filteredProxyList = [];
        let currentPage = 0;
        let rawConfigToCopy = "";

        // --- DOM ELEMENTS ---
        const notification = document.getElementById("notification-badge");
        const windowContainer = document.getElementById("container-window");
        const windowInfoContainer = document.getElementById("container-window-info");
        const htmlElement = document.getElementById("html");

        // --- HELPER FUNCTIONS ---
        const reverse = (s) => s.split("").reverse().join("");

        const getFlagEmoji = (isoCode) => {
            if (!isoCode || isoCode.length !== 2) return '🏳️';
            const codePoints = isoCode.toUpperCase().split('').map(char => 127397 + char.charCodeAt(0));
            return String.fromCodePoint(...codePoints);
        };

        const showNotification = (title, message) => {
            document.getElementById('notification-title').innerText = title;
            document.getElementById('notification-message').innerText = message;
            notification.classList.remove("opacity-0");
            setTimeout(() => {
                notification.classList.add("opacity-0");
            }, 3000);
        };

        // --- UI TOGGLES ---
        const toggleWindow = (show = true, message = "") => {
            if (show) {
                windowInfoContainer.innerText = message;
                windowContainer.classList.remove("hidden");
            } else {
                windowContainer.classList.add("hidden");
                // Hide all specific windows when the main container is hidden
                document.getElementById("output-window").classList.add("hidden");
            }
        };

        const toggleOutputWindow = () => {
            const outputWindow = document.getElementById("output-window");
            if (outputWindow.classList.contains("hidden")) {
                toggleWindow(true, "Select output:");
                outputWindow.classList.remove("hidden");
            } else {
                outputWindow.classList.add("hidden");
                toggleWindow(false);
            }
        };

        const toggleDarkMode = () => {
            htmlElement.classList.toggle("dark");
        };

        // --- CORE LOGIC ---
        const copyToClipboard = (text) => {
            rawConfigToCopy = text;
            toggleOutputWindow();
        };

        const copyToClipboardAsRaw = () => {
            navigator.clipboard.writeText(rawConfigToCopy);
            showNotification("Berhasil!", "Konfigurasi RAW berhasil disalin.");
            toggleOutputWindow();
        };

        const copyToClipboardAsTarget = async (target) => {
            toggleOutputWindow();
            toggleWindow(true, `Mengonversi ke ${target.toUpperCase()}...`);

            try {
                const res = await fetch(CONVERTER_URL, {
                    method: "POST",
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        url: rawConfigToCopy,
                        format: target,
                        template: "cf",
                    }),
                });

                if (res.ok) {
                    const convertedText = await res.text();
                    navigator.clipboard.writeText(convertedText);
                    toggleWindow(false);
                    showNotification("Berhasil!", `Konfigurasi ${target.toUpperCase()} berhasil disalin.`);
                } else {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
            } catch (error) {
                console.error("Conversion error:", error);
                toggleWindow(true, `Gagal mengonversi. Error: ${error.message}`);
                 setTimeout(() => toggleWindow(false), 3000);
            }
        };

        const navigateToPage = (page) => {
            currentPage = page;
            renderProxyCards();
            window.scrollTo(0, 0);
        };

        const checkGeoip = async () => {
            try {
                const res = await fetch(`https://api.cloudflare.com/client/v4/ips`);
                const data = await res.json();
                if (data.result) {
                    document.getElementById("container-info-ip").innerText = `IP: ${data.result.ipv4}`;
                }
                 const res2 = await fetch(`https://ip.nf/me.json`);
                 const data2 = await res2.json();
                 document.getElementById("container-info-country").innerText = `Country: ${data2.ip.country}`;
                 document.getElementById("container-info-isp").innerText = `ISP: ${data2.ip.asn}`;

            } catch (error) {
                console.error("GeoIP fetch error:", error);
                document.getElementById("container-info-ip").innerText = "IP: Error";
            }
        };

        const checkProxyStatus = async (proxy, pingElementId) => {
            const pingElement = document.getElementById(pingElementId);
            if (!pingElement) return;

            try {
                const startTime = Date.now();
                const res = await fetch(`${PROXY_HEALTH_CHECK_API}?ip=${proxy.proxyIP}&port=${proxy.proxyPort}`);
                const data = await res.json();
                const latency = Date.now() - startTime;

                pingElement.classList.remove("animate-pulse");
                if (data.proxyip === true) {
                    pingElement.textContent = `Active ${latency}ms (${data.colo || 'N/A'})`;
                    pingElement.classList.add("text-green-500");
                    pingElement.classList.remove("text-red-500", "dark:text-white");
                } else {
                    pingElement.textContent = "Inactive";
                    pingElement.classList.add("text-red-500");
                    pingElement.classList.remove("text-green-500", "dark:text-white");
                }
            } catch (error) {
                pingElement.classList.remove("animate-pulse");
                pingElement.textContent = "Check Failed";
                pingElement.classList.add("text-yellow-500");
                 pingElement.classList.remove("dark:text-white");
            }
        };

        // --- RENDERING FUNCTIONS ---
        const renderCountryFlags = () => {
            const container = document.getElementById("country-flags-container");
            const uniqueCountries = [...new Set(fullProxyList.map(p => p.country))].sort();

            container.innerHTML = `<a href="#" class="py-1" onclick="filterByCountry(null); return false;" title="Show All"><i class="fas fa-globe text-2xl text-blue-500"></i></a>`; // "All" button

            uniqueCountries.forEach(country => {
                const flagUrl = `https://hatscripts.github.io/circle-flags/flags/${country.toLowerCase()}.svg`;
                container.innerHTML += `<a href="#" class="py-1" onclick="filterByCountry('${country}'); return false;" title="${country}"><img width=28 src="${flagUrl}" class="rounded-full" /></a>`;
            });
        };

        const filterByCountry = (countryCode) => {
            if (countryCode) {
                filteredProxyList = fullProxyList.filter(p => p.country === countryCode);
            } else {
                filteredProxyList = [...fullProxyList];
            }
            currentPage = 0;
            renderProxyCards();
        };

        const renderPagination = () => {
            const container = document.getElementById("pagination-buttons");
            const totalPages = Math.ceil(filteredProxyList.length / PROXY_PER_PAGE);
            container.innerHTML = "";

            if (totalPages <= 1) return;

            // Prev button
            container.innerHTML += `<li><button ${currentPage === 0 ? 'disabled' : ''} class="px-3 py-1 bg-amber-400 border-2 border-neutral-800 dark:border-black rounded disabled:opacity-50 disabled:cursor-not-allowed" onclick="navigateToPage(${currentPage - 1})">Prev</button></li>`;

            // Next button
            container.innerHTML += `<li><button ${currentPage >= totalPages - 1 ? 'disabled' : ''} class="px-3 py-1 bg-amber-400 border-2 border-neutral-800 dark:border-black rounded disabled:opacity-50 disabled:cursor-not-allowed" onclick="navigateToPage(${currentPage + 1})">Next</button></li>`;
        };

        const renderProxyCards = () => {
            const container = document.getElementById("proxy-group-container");
            const startIndex = currentPage * PROXY_PER_PAGE;
            const endIndex = startIndex + PROXY_PER_PAGE;
            const proxiesToRender = filteredProxyList.slice(startIndex, endIndex);

            if (proxiesToRender.length === 0) {
                 container.innerHTML = `<p class="text-center text-neutral-500 dark:text-neutral-400 col-span-full">No proxies found for this filter.</p>`;
                 renderPagination();
                 return;
            }

            let proxyGroupHTML = `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">`;
            const hostName = `${SERVICE_NAME}.${ROOT_DOMAIN}`;
            const uuid = crypto.randomUUID();

            proxiesToRender.forEach((proxy, index) => {
                const globalIndex = startIndex + index;
                const flagUrl = `https://hatscripts.github.io/circle-flags/flags/${proxy.country.toLowerCase()}.svg`;
                const pingElementId = `ping-${globalIndex}`;

                const protocols = [
                    { name: `${reverse("najort")} TLS`, proto: reverse("najort"), port: 443, tls: true },
                    { name: `${reverse("sselv")} TLS`, proto: reverse("sselv"), port: 443, tls: true },
                    { name: `${reverse("ss")} TLS`, proto: reverse("ss"), port: 443, tls: true },
                    { name: `${reverse("najort")} NTLS`, proto: reverse("najort"), port: 80, tls: false },
                    { name: `${reverse("sselv")} NTLS`, proto: reverse("sselv"), port: 80, tls: false },
                    { name: `${reverse("ss")} NTLS`, proto: reverse("ss"), port: 80, tls: false },
                ];

                let buttonsHTML = '';
                const allConfigs = [];

                protocols.forEach(p => {
                    const uri = new URL(`${p.proto}://${hostName}`);
                    uri.port = p.port;
                    uri.searchParams.set("type", "ws");
                    uri.searchParams.set("host", hostName);
                    uri.searchParams.set("path", `/${proxy.proxyIP}-${proxy.proxyPort}`);
                    uri.searchParams.set("security", p.tls ? "tls" : "none");

                     if (p.proto === reverse("ss")) {
                        uri.username = btoa(`none:${uuid}`);
                        uri.searchParams.set("plugin", `v2ray-plugin;tls=${p.tls};mux=0;mode=websocket;path=/${proxy.proxyIP}-${proxy.proxyPort};host=${hostName}`);
                    } else {
                        uri.username = uuid;
                    }

                    if (p.proto === reverse("sselv") && !p.tls) {
                        uri.searchParams.set("sni", "");
                    } else {
                         uri.searchParams.set("sni", hostName);
                    }

                    uri.hash = `${globalIndex + 1} ${getFlagEmoji(proxy.country)} ${proxy.org} WS ${p.tls ? 'TLS' : 'NTLS'} [${SERVICE_NAME}]`;
                    allConfigs.push(uri.toString());
                });

                proxyGroupHTML += `
                    <div class="mb-2 bg-white dark:bg-neutral-900 transition-transform duration-200 rounded-lg p-4 w-60 border-2 border-neutral-200 dark:border-neutral-700 shadow-md">
                      <div class="absolute -translate-y-8 -translate-x-2 border-2 border-neutral-800 dark:border-white rounded-full overflow-hidden">
                        <img width="32" src="${flagUrl}" />
                      </div>
                      <div>
                        <div id="${pingElementId}" class="animate-pulse text-xs font-semibold dark:text-white">Idle ${proxy.proxyIP}:${proxy.proxyPort}</div>
                      </div>
                      <div class="rounded py-1 px-2 my-2 bg-amber-400 dark:bg-neutral-800 dark:border-2 dark:border-amber-400">
                        <h5 class="font-bold text-md text-neutral-900 dark:text-white mb-1 overflow-x-auto scrollbar-hide text-nowrap">${proxy.org}</h5>
                        <div class="text-neutral-900 dark:text-white text-sm">
                          <p>IP: ${proxy.proxyIP}</p>
                          <p>Port: ${proxy.proxyPort}</p>
                        </div>
                      </div>
                      <div class="flex justify-center mt-3">
                         <button class="bg-blue-500 dark:bg-neutral-800 dark:border-2 dark:border-blue-500 rounded p-2 w-full text-white font-semibold" onclick="copyToClipboard('${allConfigs.join('\\n')}')">
                           <i class="fas fa-copy mr-2"></i>Copy Configs
                         </button>
                      </div>
                    </div>
                `;
                 checkProxyStatus(proxy, pingElementId);
            });

            proxyGroupHTML += `</div>`;
            container.innerHTML = proxyGroupHTML;
            renderPagination();
        };

        const loadInitialData = async () => {
            try {
                const res = await fetch(PROXY_BANK_URL);
                const text = await res.text();
                fullProxyList = text.split("\n").filter(Boolean).map(line => {
                    const [proxyIP, proxyPort, country, org] = line.split(",");
                    return { proxyIP, proxyPort, country, org: org || "Unknown Org" };
                });
                filteredProxyList = [...fullProxyList];
                renderCountryFlags();
                renderProxyCards();
            } catch (error) {
                console.error("Failed to load proxy list:", error);
                document.getElementById("proxy-group-container").innerHTML = `<p class="text-center text-red-500">Gagal memuat daftar proxy. Silakan coba lagi nanti.</p>`;
            }
        };

        // --- INITIALIZATION ---
        window.onload = () => {
            document.getElementById('donate-link').href = DONATE_LINK;
            checkGeoip();
            loadInitialData();
        };

        window.onscroll = () => {
            const paginationContainer = document.getElementById("container-pagination");
            if (window.innerHeight + Math.round(window.scrollY) >= document.body.offsetHeight) {
                paginationContainer.classList.remove("-translate-y-6");
            } else {
                paginationContainer.classList.add("-translate-y-6");
            }
        };
    </script>
  </body>
</html>

